<!DOCTYPE html>
<html>
<head>
    <title>Chat</title>
    <meta charset="utf-8" />
    <meta name="theme-color" content="#ff3d8e" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/material.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body::-webkit-scrollbar-track {
            /*-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);*/
            background-color: #F5F5F5;
            border-radius: 10px;
        }

        body::-webkit-scrollbar {
            width: 6px;
            background-color: #F5F5F5;
        }

        body::-webkit-scrollbar-thumb {
            border-radius: 10px;
            background-color: #eeeeee;
        }
    </style>
</head>
<body>
    <div class="container maincontainer">
        <div class="menubar chat">
            <div class="logo">
                <img src="images/logo_large.png" />
            </div>

            <div class="action">
                <button class="btn-noborder" id="btn_logout">
                    logout
                </button>
            </div>

        </div>

        <div class="chat_box_wrapper">
            <div class="chat_box" id="chat_box">
                <div class="chat_message_wrapper chat_message_right">
                    <ul class="chat_message">
                        <li>
                            <p>Hey, How are you?</p>
                        </li>

                    </ul>
                </div>
                <div class="chat_message_wrapper chat_message_right">
                    <ul class="chat_message">
                        <li>
                            <p>Hey, How are you?</p>
                        </li>
                        <li>
                            <span class="chat_time">2 Mins ago</span>
                        </li>
                    </ul>
                </div>

                <div class="chat_message_wrapper chat_message_left">
                    <ul class="chat_message">
                        <li>
                            <p>I‚Äôm Great.<br />Please share some images <br />üòé</p>
                        </li>
                        <li>
                            <span class="chat_time">Just now</span>
                        </li>
                    </ul>
                </div>

                <!--<div class="chat_message_wrapper chat_message_left">
                    <ul class="chat_message">
                        <li>
                            <p>It‚Äôs urgent</p>
                        </li>
                        <li>
                            <span class="chat_time">Just now</span>
                        </li>
                    </ul>
                </div>-->

                <div class="chat_message_wrapper chat_image chat_message_right">
                    <ul class="chat_message">
                        <li>
                            <img src="images/chat-image.png" />
                        </li>

                    </ul>
                </div>

                <div class="chat_message_wrapper chat_message_right">
                    <ul class="chat_message">
                        <li>
                            <p>Menu</p>
                        </li>
                        <li>
                            <span class="chat_time">Just now</span>
                        </li>
                    </ul>
                </div>

                <div class="chat_message_wrapper chat_message_left">
                    <ul class="chat_message">
                        <li>
                            <p>Welcome to NearGroup<br />What do you prefere to do right now?</p>
                        </li>
                        <li class="chat_buttons">
                            <!--chat buttons should have class  "chat_buttons"-->
                            <a class="btn-outline-blue" onclick="window.location.href = 'myprofile.html'">My Profile</a>
                            <a class="btn-outline-blue" onclick="window.location.href = 'editprofile.html'">Edit Profile</a>
                        </li>
                        <li>
                            <!--timestamp should comes as last li-->
                            <span class="chat_time">2 Mins ago</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="chatcontrols">
            <div class="attach">
                <!--<button class="mdl-button mdl-js-button mdl-button--icon" id="btn_menu">
                    <i class="material-icons">menu</i>
                </button>-->
                <label class="mdl-button mdl-js-button mdl-button--icon" for="browseimage">
                    <!--<img src="images/camera.png" />-->
                    <i class="material-icons">photo_camera</i>
                    <input type="file" id="browseimage" name='browseimage' class="hide" onchange="readURL(this);" />
                </label>
                <button class="mdl-button mdl-js-button mdl-button--icon">
                    <i class="material-icons">sentiment_very_satisfied</i>
                </button>


            </div>
            <div class="chatmessage"><textarea id="chatmessagetext" placeholder="Write a reply..."></textarea></div>
            <div class="sendbutton">
                <button class="mdl-button mdl-js-button mdl-button--icon" id="btn_send">
                    <i class="material-icons">send</i>
                </button>
            </div>
        </div>
    </div>

    <div class="chatmenus" id="chatmenus">
        <!--style="display:none;"-->
        <div class="head">Our Suggestions</div>
        <!--<a class="close" id="btn_close">Close</a>-->
        <div class="chips">
            <span class="mdl-chip">
                <span class="mdl-chip__text">üíë Blind Chat</span>
            </span>
            <span class="mdl-chip">
                <span class="mdl-chip__text">üíµ Earn Money</span>
            </span>
            <span class="mdl-chip">
                <span class="mdl-chip__text">üé≥ Group Chat</span>
            </span>
            <span class="mdl-chip">
                <span class="mdl-chip__text">ü§ó Feedback from friend</span>
            </span>
            <span class="mdl-chip">
                <span class="mdl-chip__text">üìä Report / Feedback</span>
            </span>
            <span class="mdl-chip">
                <span class="mdl-chip__text">‚ù§Ô∏è My Favs</span>
            </span>
            <span class="mdl-chip">
                <span class="mdl-chip__text">üõç Shop nearby</span>
            </span>
            <span class="mdl-chip">
                <span class="mdl-chip__text">üóæ Edit Location</span>
            </span>
        </div>
    </div>

    <div id="toast-message" class="mdl-js-snackbar mdl-snackbar" style="width:100%;">
        <div class="mdl-snackbar__text"></div>
        <button class="mdl-snackbar__action" type="button"></button>
    </div>
</body>
</html>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script defer src="js/material.min.js"></script>


<script type="text/javascript">
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#imgprofile').attr('src', e.target.result)
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#btn_send").click(function () {
        sendmessage();
    });


    function sendmessage() {
        var message = $.trim($("#chatmessagetext").val());
        if (message != "") {
            message = message.replace(/(?:\r\n|\r|\n)/g, '<br />');

            $(".newchat").removeClass("newchat");
            $("#chat_box").append('<div class="chat_message_wrapper chat_message_right newchat"><ul class="chat_message"><li><p>' + message + '</p></li><li> <span class="chat_time">Just now</span></li></ul></div>');

            updateScrollbar();

            $(".newchat").addClass('visible bounce animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function () {
                $(this).removeClass('bounce animated');
            });

            $("#chatmessagetext").val("");
            $("#chatmessagetext").focus();
           // $(".attach").show();
            $(".attach").show("slide", { direction: "left" }, 300);
        }
    }

    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {

                var image = new Image();
                image.src = e.target.result;
                var originalwidth = 0;
                var originalheight = 0;
                image.onload = function () {
                    // access image size here
                    console.log(this.width);
                    originalwidth = this.width;
                    originalheight = this.height;

                    $(".newchat").removeClass("newchat");
                    $("#chat_box").append('<div class="chat_message_wrapper newchat chat_image chat_message_right"><ul class="chat_message"><li><img src="' + e.target.result + '" /></li></ul></div>');
                    var image = $(".newchat").find('img');
                    var ar = calculateAspectRatioFit(originalwidth, originalheight, 200, 200);
                    $(image).css("width", ar.width);
                    $(image).css("height", ar.height);
                    updateScrollbar();

                    $(".newchat").addClass('visible bounce animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function () {
                        $(this).removeClass('bounce animated');
                    });
                };




            };

            reader.readAsDataURL(input.files[0]);
        }
    }

    function updateScrollbar() {
        window.scrollTo(0, document.body.scrollHeight);

        //$('html,body').animate({ scrollTop: $(window).outerHeight() }, 100);
    }

    $("#chatmessagetext").on("change keypress keyup", function () {
        if ($.trim($(this).val()) == "") {
            $("#btn_send").removeClass("active");
            //$(".attach").show();
            $(".attach").show("slide", { direction: "left" }, 300);
            
        }
        else {
            $("#btn_send").removeClass("active").addClass("active");
            //$(".attach").hide();
            $(".attach").hide("slide", { direction: "left" }, 300);
        }
    });

    $("#btn_menu").on("click", function () {
        $("#chatmenus").show("slide", { direction: "down" }, 300);


    });


    $("#btn_close").on("click", function () {
        $("#chatmenus").hide("slide", { direction: "down" }, 300);

    });

    $("#chatmenus").find(".mdl-chip").on("click", function () {

        $("#chatmenus").hide("slide", { direction: "down" }, 300);

        $(".newchat").removeClass("newchat");
        $("#chat_box").append('<div class="chat_message_wrapper chat_message_right newchat"><ul class="chat_message"><li><p>' + $(this).find(".mdl-chip__text").text() + '</p></li><li> <span class="chat_time">Just now</span></li></ul></div>');

        updateScrollbar();

        $(".newchat").addClass('visible bounce animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function () {
            $(this).removeClass('bounce animated');
        });


        //$("#chatmessagetext").focus();

    });


    function calculateAspectRatioFit(srcWidth, srcHeight, maxWidth, maxHeight) {

        var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);

        return { width: srcWidth * ratio, height: srcHeight * ratio };
    }


    $('#chatmessagetext').keyup(function (event) {
        if (event.keyCode == 13 && event.altKey) {
            var content = this.value;
            var caret = getCaret(this);
            this.value = content.substring(0, caret) + "\n" + content.substring(caret, content.length);
            event.stopPropagation();

        } else if (event.keyCode == 13) {
            event.stopPropagation();
            sendmessage();

        }
    });
    function getCaret(el) {
        if (el.selectionStart) {
            return el.selectionStart;
        } else if (document.selection) {
            el.focus();

            var r = document.selection.createRange();
            if (r == null) {
                return 0;
            }

            var re = el.createTextRange(),
                rc = re.duplicate();
            re.moveToBookmark(r.getBookmark());
            rc.setEndPoint('EndToStart', re);

            return rc.text.length;
        }
        return 0;
    }

</script>